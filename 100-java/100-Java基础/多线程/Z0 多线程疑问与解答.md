# 1 Object.wait(), Thread.join()和 LockSupport.park() 区别

`Object.wait()`, `Thread.join()`, 和 `LockSupport.park()` 是 Java 中用于线程同步和协调的三种不同机制。它们有不同的用途和特性，下面是它们的主要区别和使用场景：

## 1.1 `Object.wait()`

- **基本概念**: `wait()` 是 `Object` 类的方法，用于使当前线程进入等待状态，并释放当前线程所持有的对象的锁。

- **用途**: 通常与 `notify()` 和 `notifyAll()` 一起使用，以实现线程间的协调。一个线程可以调用某对象的 `wait()` 方法，使自己进入等待状态，直到另一个线程调用同一对象的 `notify()` 或 `notifyAll()` 方法唤醒它。

- **特性**:
  - 必须在同步块或同步方法中使用，因为线程必须持有对象的监视器锁才能调用 `wait()`。
  - 调用 `wait()` 时，线程释放持有的对象锁。
  - 可以指定等待的超时时间：`wait(long timeout)`，线程会在指定时间后自动唤醒（如果没有被提前唤醒）。

- **示例**:
  ```java
  synchronized (obj) {
      while (condition) {
          obj.wait();
      }
      // 继续执行
  }
  ```

## 1.2 `Thread.join()`

- **基本概念**: `join()` 是 `Thread` 类的方法，用于让当前线程等待另一个线程完成执行。

- **用途**: 主要用于确保一个线程在另一个线程完成执行后才继续执行。例如，在一个主线程中启动多个子线程并行工作，然后使用 `join()` 等待所有子线程完成。

- **特性**:
  - `join()` 方法是非同步的，不需要在同步块中使用。
  - 可以指定等待的超时时间：`join(long millis)`，当前线程会在指定时间后自动继续执行（如果等待的线程还未结束）。

- **示例**:
  ```java
  Thread t = new Thread(() -> {
      // 执行一些任务
  });
  t.start();
  t.join(); // 当前线程等待t线程完成
  ```

## 1.3 `LockSupport.park()`

- **基本概念**: `LockSupport` 类提供了更底层和灵活的线程阻塞和解除阻塞机制。`park()` 方法使当前线程进入等待状态，直到其他线程调用 `unpark(Thread)` 方法来恢复它。

- **用途**: 通常用于实现自定义的同步工具或锁，提供比 `wait()` 和 `notify()` 更细粒度的控制。

- **特性**:
  - 与 `wait()` 和 `notify()` 不同，`park()` 和 `unpark()` 不需要在同步块中使用，也不依赖于对象监视器。
  - `park()` 是可中断的，线程可以响应中断。
  - 可以与 `parkNanos()` 或 `parkUntil()` 方法结合使用，实现超时等待。

- **示例**:
  ```java
  LockSupport.park();
  // 线程被阻塞，直到其他线程调用LockSupport.unpark()唤醒它
  ```

## 1.4 总结

- `Object.wait()` 和 `notify()`/`notifyAll()` 用于线程间的协调和通信，需要在同步块中使用，依赖于对象的监视器。
- `Thread.join()` 用于让当前线程等待另一个线程结束，常用于确保线程的顺序执行，不需要同步块。
- `LockSupport.park()` 和 `unpark()` 提供了更底层的线程阻塞机制，不依赖于同步块或对象监视器，适用于实现高级并发控制工具。
## 1.5 资源的管理

• **Object.wait()**: 释放当前线程持有的对象的锁资源，阻塞线程不消耗CPU资源。
• **Thread.join()**: 不释放任何锁资源，阻塞线程不消耗CPU资源。
• **LockSupport.park()**: 不涉及锁资源的管理，阻塞线程不消耗CPU资源。

在选择使用哪种方法时，应根据具体的同步需求和资源管理的要求来决定。例如，如果需要在释放锁资源的同时进行线程等待，可以选择 Object.wait()；如果只是需要等待某个线程结束，可以使用 Thread.join()；而如果需要更灵活的阻塞控制且不涉及锁管理，可以考虑 LockSupport.park()。