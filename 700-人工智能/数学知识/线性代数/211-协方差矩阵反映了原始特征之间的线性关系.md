我们通过**3个具体案例**​（包含正相关、负相关、无关变量等场景），直观理解“协方差矩阵如何反映原始特征之间的线性关系”。每个案例均包含数据生成、协方差矩阵计算、结果分析三步。

+ 如果将三个矩阵标准化后，再观察每个特征的线性关系，会发现线性关系非常明显：[212-标准化后的协方差矩阵分析](212-标准化后的协方差矩阵分析.md)

---

# 1 ​**案例1：两个变量负相关（学习时间 vs 错误率）​**​

​**背景**​：假设学生学习时间（$X$）越长，考试错误率（$Y$）越低（负相关）。我们生成5组模拟数据：

|学生ID|学习时间（小时，X）|错误率（%，Y）|
|---|---|---|
|1|10|15|
|2|20|10|
|3|30|5|
|4|40|2|
|5|50|1|

## 1.1 ​**步骤1：计算均值**​

$$
\mu_X = \frac{10+20+30+40+50}{5} = 30, \quad \mu_Y = \frac{15+10+5+2+1}{5} = 6.6
$$

## 1.2 ​**步骤2：计算协方差矩阵**​

协方差矩阵为 $2 \times 2$ 矩阵：

$$
\Sigma = \begin{bmatrix}
\text{Var}(X) & \text{Cov}(X,Y) \\
\text{Cov}(Y,X) & \text{Var}(Y)
\end{bmatrix}
$$

### 1.2.1 计算 $\text{Var}(X)$（X的方差）：

$$
\text{Var}(X) = \frac{(10-30)^2 + (20-30)^2 + (30-30)^2 + (40-30)^2 + (50-30)^2}{5-1} = \frac{400+100+0+100+400}{4} = 250
$$

### 1.2.2 计算 $\text{Var}(Y)$（Y的方差）：

$$
\text{Var}(Y) = \frac{(15-6.6)^2 + (10-6.6)^2 + (5-6.6)^2 + (2-6.6)^2 + (1-6.6)^2}{4} = \frac{69.69+11.56+2.56+21.16+31.36}{4} \approx 33.56
$$

### 1.2.3 计算 $\text{Cov}(X,Y)$（X与Y的协方差）：

$$
\text{Cov}(X,Y) = \frac{(10-30)(15-6.6) + (20-30)(10-6.6) + (30-30)(5-6.6) + (40-30)(2-6.6) + (50-30)(1-6.6)}{4}
$$

$$
= \frac{(-20)(8.4) + (-10)(3.4) + 0(-1.6) + 10(-4.6) + 20(-5.6)}{4} = \frac{-168 -34 + 0 -46 -112}{4} = \frac{-360}{4} = -90
$$

## 1.3 ​**协方差矩阵结果**​：

$$
\Sigma = \begin{bmatrix}
250 & -90 \\
-90 & 33.56
\end{bmatrix}
$$

## 1.4 ​**结果分析**​

- 对角线元素（方差）：$\text{Var}(X)=250$（学习时间波动大），$\text{Var}(Y)=33.56$（错误率波动小）。
- 非对角线元素（协方差）：$\text{Cov}(X,Y)=-90 < 0$，说明X（学习时间）与Y（错误率）​**高度负相关**——学习时间越长，错误率越低。
- 协方差的绝对值越大（这里是90），线性关系越强；若为0则无线性关系。

---

# 2 ​**案例2：三个变量两两正相关（身高、体重、鞋码）​**​

​**背景**​：身高、体重、鞋码通常呈正相关（个子高的人往往更重、鞋码更大）。生成5组模拟数据：

|学生ID|身高（cm，X）|体重（kg，Y）|鞋码（EU，Z）|
|---|---|---|---|
|1|160|50|38|
|2|170|60|40|
|3|180|70|42|
|4|165|55|39|
|5|175|65|41|

## 2.1 ​**步骤1：计算均值**​

$$
\mu_X = \frac{160+170+180+165+175}{5} = 170, \quad \mu_Y = \frac{50+60+70+55+65}{5} = 60, \quad \mu_Z = \frac{38+40+42+39+41}{5} = 40
$$

## 2.2 ​**步骤2：计算协方差矩阵**​

协方差矩阵为 $3 \times 3$ 矩阵：

$$
\Sigma = \begin{bmatrix}
\text{Var}(X) & \text{Cov}(X,Y) & \text{Cov}(X,Z) \\
\text{Cov}(Y,X) & \text{Var}(Y) & \text{Cov}(Y,Z) \\
\text{Cov}(Z,X) & \text{Cov}(Z,Y) & \text{Var}(Z)
\end{bmatrix}
$$

### 2.2.1 计算 $\text{Var}(X)$（身高方差）：

$$
\text{Var}(X) = \frac{(160-170)^2 + (170-170)^2 + (180-170)^2 + (165-170)^2 + (175-170)^2}{4} = \frac{100+0+100+25+25}{4} = 61.25
$$

### 2.2.2 计算 $\text{Var}(Y)$（体重方差）：

$$
\text{Var}(Y) = \frac{(50-60)^2 + (60-60)^2 + (70-60)^2 + (55-60)^2 + (65-60)^2}{4} = \frac{100+0+100+25+25}{4} = 61.25
$$

### 2.2.3 计算 $\text{Var}(Z)$（鞋码方差）：

$$
\text{Var}(Z) = \frac{(38-40)^2 + (40-40)^2 + (42-40)^2 + (39-40)^2 + (41-40)^2}{4} = \frac{4+0+4+1+1}{4} = 2.5
$$

### 2.2.4 计算 $\text{Cov}(X,Y)$（身高与体重协方差）：

$$
\text{Cov}(X,Y) = \frac{(160-170)(50-60) + (170-170)(60-60) + (180-170)(70-60) + (165-170)(55-60) + (175-170)(65-60)}{4}
$$

$$
= \frac{(-10)(-10) + 0(0) + 10(10) + (-5)(-5) + 5(5)}{4} = \frac{100+0+100+25+25}{4} = 61.25
$$

### 2.2.5 计算 $\text{Cov}(X,Z)$（身高与鞋码协方差）：

$$
\text{Cov}(X,Z) = \frac{(160-170)(38-40) + (170-170)(40-40) + (180-170)(42-40) + (165-170)(39-40) + (175-170)(41-40)}{4}
$$

$$
= \frac{(-10)(-2) + 0(0) + 10(2) + (-5)(-1) + 5(1)}{4} = \frac{20+0+20+5+5}{4} = 12.5
$$

### 2.2.6 计算 $\text{Cov}(Y,Z)$（体重与鞋码协方差）：

$$
\text{Cov}(Y,Z) = \frac{(50-60)(38-40) + (60-60)(40-40) + (70-60)(42-40) + (55-60)(39-40) + (65-60)(41-40)}{4}
$$

$$
= \frac{(-10)(-2) + 0(0) + 10(2) + (-5)(-1) + 5(1)}{4} = \frac{20+0+20+5+5}{4} = 12.5
$$

## 2.3 ​**协方差矩阵结果**​：

$$
\Sigma = \begin{bmatrix}
61.25 & 61.25 & 12.5 \\
61.25 & 61.25 & 12.5 \\
12.5 & 12.5 & 2.5
\end{bmatrix}
$$

## 2.4 ​**结果分析**​

- 对角线元素（方差）：身高和体重的方差较大（61.25），鞋码方差较小（2.5），符合常识（身高体重波动更大）。
- 非对角线元素（协方差）：
    - $\text{Cov}(X,Y)=61.25 > 0$：身高与体重强正相关（个子高的人更重）；
    - $\text{Cov}(X,Z)=12.5 > 0$：身高与鞋码正相关（个子高的人鞋码大）；
    - $\text{Cov}(Y,Z)=12.5 > 0$：体重与鞋码正相关（更重的人鞋码更大）；
- 协方差的大小反映线性关系强弱：身高与体重的协方差（61.25）远大于身高与鞋码（12.5），说明身高与体重的线性关系比身高与鞋码更紧密。

---

# 3 ​**案例3：三个变量中两两无关（独立特征）​**​

​**背景**​：假设三个变量完全独立（无线性关系），例如：

- $X$：今天的温度（℃）；
- $Y$：明天的降雨量（mm）；
- $Z$：后天的股票涨幅（%）。

生成5组模拟数据（假设完全独立，无任何关联）：

|样本|温度（X）|降雨量（Y）|股票涨幅（Z）|
|---|---|---|---|
|1|25|0|1.2|
|2|28|2|-0.5|
|3|22|5|0.8|
|4|26|1|2.1|
|5|30|3|-1.0|

## 3.1 ​**步骤1：计算均值**​

$$
\mu_X = \frac{25+28+22+26+30}{5} = 26.2, \quad \mu_Y = \frac{0+2+5+1+3}{5} = 2.2, \quad \mu_Z = \frac{1.2-0.5+0.8+2.1-1.0}{5} = 0.52
$$

## 3.2 ​**步骤2：计算协方差矩阵**​

协方差矩阵为 $3 \times 3$ 矩阵：

$$
\Sigma = \begin{bmatrix}
\text{Var}(X) & \text{Cov}(X,Y) & \text{Cov}(X,Z) \\
\text{Cov}(Y,X) & \text{Var}(Y) & \text{Cov}(Y,Z) \\
\text{Cov}(Z,X) & \text{Cov}(Z,Y) & \text{Var}(Z)
\end{bmatrix}
$$

### 3.2.1 计算 $\text{Var}(X)$（温度方差）：

$$
\text{Var}(X) = \frac{(25-26.2)^2 + (28-26.2)^2 + (22-26.2)^2 + (26-26.2)^2 + (30-26.2)^2}{4} = \frac{1.44+3.24+17.64+0.04+14.44}{4} = 6.69
$$

### 3.2.2 计算 $\text{Var}(Y)$（降雨量方差）：

$$
\text{Var}(Y) = \frac{(0-2.2)^2 + (2-2.2)^2 + (5-2.2)^2 + (1-2.2)^2 + (3-2.2)^2}{4} = \frac{4.84+0.04+7.84+1.44+0.64}{4} = 3.46
$$

### 3.2.3 计算 $\text{Var}(Z)$（股票涨幅方差）：

$$
\text{Var}(Z) = \frac{(1.2-0.52)^2 + (-0.5-0.52)^2 + (0.8-0.52)^2 + (2.1-0.52)^2 + (-1.0-0.52)^2}{4} = \frac{0.4624+1.0404+0.0784+2.4964+2.3104}{4} = 1.597
$$

### 3.2.4 计算 $\text{Cov}(X,Y)$（温度与降雨量协方差）：

$$
\text{Cov}(X,Y) = \frac{(25-26.2)(0-2.2) + (28-26.2)(2-2.2) + (22-26.2)(5-2.2) + (26-26.2)(1-2.2) + (30-26.2)(3-2.2)}{4}
$$

$$
= \frac{(-1.2)(-2.2) + (1.8)(-0.2) + (-4.2)(2.8) + (-0.2)(-1.2) + (3.8)(0.8)}{4} = \frac{2.64 -0.36 -11.76 +0.24 +3.04}{4} = \frac{-6.2}{4} \approx -1.55
$$

（注：这里因数据是随机模拟的，实际无关变量的协方差可能接近0，但因样本量小，可能有微小波动。）

### 3.2.5 计算 $\text{Cov}(X,Z)$（温度与股票涨幅协方差）：

$$
\text{Cov}(X,Z) = \frac{(25-26.2)(1.2-0.52) + (28-26.2)(-0.5-0.52) + (22-26.2)(0.8-0.52) + (26-26.2)(2.1-0.52) + (30-26.2)(-1.0-0.52)}{4}
$$

$$
= \frac{(-1.2)(0.68) + (1.8)(-1.02) + (-4.2)(0.28) + (-0.2)(1.58) + (3.8)(-1.52)}{4} = \frac{-0.816 -1.836 -1.176 -0.316 -5.776}{4} = \frac{-9.92}{4} \approx -2.48
$$

### 3.2.6 计算 $\text{Cov}(Y,Z)$（降雨量与股票涨幅协方差）：

$$
\text{Cov}(Y,Z) = \frac{(0-2.2)(1.2-0.52) + (2-2.2)(-0.5-0.52) + (5-2.2)(0.8-0.52) + (1-2.2)(2.1-0.52) + (3-2.2)(-1.0-0.52)}{4}
$$

$$
= \frac{(-2.2)(0.68) + (-0.2)(-1.02) + (2.8)(0.28) + (-1.2)(1.58) + (0.8)(-1.52)}{4} = \frac{-1.496 +0.204 +0.784 -1.896 -1.216}{4} = \frac{-3.62}{4} \approx -0.905
$$

## 3.3 ​**协方差矩阵结果（近似）​**​：

$$
\Sigma \approx \begin{bmatrix}
6.69 & -1.55 & -2.48 \\
-1.55 & 3.46 & -0.905 \\
-2.48 & -0.905 & 1.597
\end{bmatrix}
$$

## 3.4 ​**结果分析**​

- 对角线元素（方差）：反映各变量的波动程度（温度＞降雨量＞股票涨幅）。
- 非对角线元素（协方差）：
    - 所有协方差的绝对值都很小（接近0），说明变量间**无线性关系**；
    - 例如，温度与降雨量的协方差为-1.55，可能是随机误差导致的微小波动，而非真实关联；
    - 若变量真正独立，理论上协方差应为0（实际中因样本量小可能有微小偏差）。

---

# 4 ​**总结：协方差矩阵如何反映线性关系？​**​

通过以上案例可总结：

1. ​**协方差的正负**​：反映变量间的**线性相关方向**​（正相关/负相关/无关）；
    
    - $\text{Cov}(X,Y) > 0$：X增大时，Y倾向于增大（正相关）；
    - $\text{Cov}(X,Y) < 0$：X增大时，Y倾向于减小（负相关）；
    - $\text{Cov}(X,Y) \approx 0$：X与Y无线性关系（但可能有非线性关系）。
2. ​**协方差的绝对值大小**​：反映**线性关系的强弱**；
    
    - 绝对值越大，线性关系越强（如案例1中$\text{Cov}(X,Y)=-90$，负相关极强）；
    - 绝对值越小，线性关系越弱（如案例3中协方差接近0，无线性关系）。
3. ​**协方差矩阵的对称性**​：$\text{Cov}(X,Y) = \text{Cov}(Y,X)$，这是协方差矩阵的基本性质。
    
4. ​**方差的作用**​：对角线元素（方差）反映变量的**自身波动程度**，是协方差矩阵的基础信息。
    

通过这些例子，可以直观理解：协方差矩阵本质上是用一个矩阵“量化”了所有原始特征之间的线性关系方向和强度，是PCA等降维算法的核心输入。